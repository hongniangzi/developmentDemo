{extend name="base/common" /}
{block name="title"}栏目管理{/block}

{block name="main"}
<!--  -->
    <div class="rbox">
        <div class="top">
            <h2>栏目管理(编辑)</h2>
        </div>
        <div class="btm">
            <form id="myForm">
                <table border="0" cellpadding="0" cellspacing="0" class="table02" width="400">
                    <tr>
                        <td align="right" width="200">栏目名称：</td>
                        <td><input type="text" class="intxt" name="title" value="{$info.title}"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">英文栏目名称（非必填）：</td>
                        <td><input type="text" class="intxt" name="title_en" value="{$info.title_en}"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">路由标识：</td>
                        <td><input type="text" class="intxt" name="rout_name" value="{$info.rout_name}"><span>（多词请使用小驼峰规则）</span></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">导航显示：</td>
                        <td>
                            <label><input type="radio" name="is_nav" value="1" {$info['is_nav']==1?'checked="true"':''} > 显示</label>
                            &emsp;&emsp;&emsp;
                            <label><input type="radio" name="is_nav" value="0" {$info['is_nav']===0?'checked="true"':''} > 否</label>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" width="100">排序（正序排列）：</td>
                        <td><input type="text" class="intxt" name="sort" value="{$info.sort}"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">是否允许发布内容：</td>
                        <td>
                            <label><input type="radio" name="is_release" value="1" {$info['is_release']==1?'checked="true"':''} > 允许</label>
                            &emsp;&emsp;&emsp;
                            <label><input type="radio" name="is_release" value="0" {$info['is_release']===0?'checked="true"':''} > 否</label>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" width="100">封面宽度（非必填）：</td>
                        <td><input type="text" class="intxt" name="cover_width" value="{$info.cover_width}"  placeholder="支持缩放后的比列(宽)"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">封面高度（非必填）：</td>
                        <td><input type="text" class="intxt" name="cover_height" value="{$info.cover_height}" placeholder="支持缩放后的比列(高)"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">封面提示：</td>
                        <td><input type="text" class="intxt" name="cover_img_tips" value="{$info.cover_height}"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">栏目SEO关键词（非必填）：</td>
                        <td><input type="text" class="intxt" name="site_keywords" value="{$info.site_keywords}"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">栏目SEO描述（非必填）：</td>
                        <td><input type="text" class="intxt" name="site_description" value="{$info.site_description}"></td>
                    </tr>
                    <tr>
                        <td align="right" width="100">栏目小图标（非必填）：</td>
                        <td>
                            <div class="small-icon">
                                <div class="layui-form-item">
                                    <div class="layui-input-inline">
                                        <div class="layui-upload-list" style="margin:0">
                                            
                                            <img src="{if condition='$info["small_icon"]'}{$info.small_icon|getImagePath}{else/}__IMG__/default-img.jpg{/if}" id="srcimgurl-small-icon" class="layui-upload-img" style="width: 150px;">
                                            <input type="hidden" name="small_icon" value="{$info.small_icon}">
                                        </div>
                                    </div>
                                    <div class="layui-input-inline layui-btn-container" style="width: auto;">
                                        <a href="javascript:;" class="layui-btn layui-btn-primary" id="small-icon">修改图片</a>
                                    </div>
                                    <div class="layui-form-mid layui-word-aux">小图标限定大小在100kb以内</div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" width="100">栏目背景图（非必填）：</td>
                        <td>
                            <div class="big-icon" class="layui-upload">
                                <a href="javascript:;" class="layui-btn" id="big-icon">上传图片</a>
                                <div class="layui-upload-list">
                                    <input type="hidden" class="intxt" name="big_icon" value="{$info.big_icon}">
                                    <img src="{$info.big_icon|getImagePath}" class="layui-upload-img" id="preview-big-icon">
                                    <p id="text-big-icon"></p>
                                </div>
                                <div class="layui-form-mid layui-word-aux">背景图限定大小在500kb以内</div>
                            </div> 
                        </td>
                    </tr>
                    <tr>
                        <td align="right" width="150">栏目描述（非必填）：</td>
                        <td>
                            <textarea name="description" id="" cols="40" rows="8" style="resize: none;">{$info.description}</textarea>
                        </td>
                    </tr>

                    <tr>
                        <td></td>
                        <td>
                            <input type="hidden" name="id" value="{$info.id}">
                            <input type="button" class="inbtn" value="确认" id="formButton">
                            <input type="button" class="inback" value="返回" onclick="window.history.back()">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
    
    <style>
        /* #myForm{width: 620px;} */
    </style>
    <link rel="stylesheet" href="__JS__/layui/css/layui.css">
    <link rel="stylesheet" href="__JS__/layui-cropper/cropper.css">
    <script src="__JS__/layui-cropper/cropper.js"></script>
    <script src="__JS__/layui-cropper/croppers.js"></script>
    <script>
        layui.config({
            base: '__JS__/layui-cropper/' //layui自定义layui组件目录
        }).use(['layer','croppers','upload'], function(){
            const layer = layui.layer,
                croppers = layui.croppers,
                upload=layui.upload;

            // 栏目小图标上传
            croppers.render({
                elem: '#small-icon',
                saveW:150,     //保存宽度
                saveH:150,
                mark:1/1,    //选取比例
                area:'900px',  //弹窗宽度
                url: "/system/uploadImg",  //图片上传接口返回和（layui 的upload 模块）返回的JOSN一样
                done: function(res){ //上传完毕回调
                    console.log(res);
                    if(res.status==1){
                        // $("#inputimgurl-small-icon").val(url);
                        $("#srcimgurl-small-icon").attr('src',res.Msg);
                        $(".small-icon input[name='small_icon']").val(res.id);
                    }else{
                        // 上传失败
                        layer.msg(`上传失败：${res.Msg}`,{"icon":7});
                    }
                }
            });

            // 栏目背景图上传
            var uploadInst = upload.render({
                elem: '#big-icon',
                url: '/system/uploadImg',
                before: function(obj){
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result){
                        $('#preview-big-icon').attr('src', result); //图片链接（base64）
                    });
                },
                done: function(res){
                    if(res.status==1){
                        //上传成功
                        $(".big-icon input[name='big_icon']").val(res.id);
                    }else{
                        // 上传失败
                        layer.msg(`上传失败：${res.Msg}`,{"icon":7});
                    }
                   
                },
                error: function(){
                    //演示失败状态，并实现重传
                    var demoText = $('#text-big-icon');
                    demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                    demoText.find('.demo-reload').on('click', function(){
                        uploadInst.upload();
                    });
                }
            });

            $('#myForm #formButton').click(function(){
                $(this).attr('disabled','disabled');
                layer.load();
                const formData = new FormData($('#myForm')[0]);
                promisePost("/column/columnEdit",formData).then((res)=>{
                    if(res.status==1){
                        // 跳转
                        layer.msg(res.Msg,{"icon":1,"time":800},()=>window.history.back());
                    }else{
                        layer.msg(res.Msg,{"icon":7});
                    }
                },(error)=>layer.msg(error,{"icon":7}))

                $(this).removeAttr('disabled');
                layer.closeAll('loading');
            })
        })
    </script>
{/block}